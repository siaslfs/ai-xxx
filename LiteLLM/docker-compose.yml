services:
  litellm:
    image: docker.litellm.ai/berriai/litellm:main-stable
    container_name: litellm_proxy
    restart: always
    ports:
      - "4000:4000"
    volumes:
      - ./config.yaml:/app/config.yaml
    command: ["--config", "/app/config.yaml"]
    env_file:
      - .env
    healthcheck:
      test: ["CMD-SHELL", "python3 -c \"import urllib.request; urllib.request.urlopen(\"http://localhost:4000/health/liveliness\" )\""]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 60s

  # db:
  #   image: postgres:16
  #   container_name: litellm_db
  #   restart: always
  #   environment:
  #     POSTGRES_DB: ${POSTGRES_DB:-litellm}
  #     POSTGRES_USER: ${POSTGRES_USER:-llmproxy}
  #     POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
  #   volumes:
  #     - postgres_data:/var/lib/postgresql/data
  #   ports:
  #     - "15432:5432"
  #   healthcheck:
  #     test: ["CMD-SHELL", "pg_isready -d ${POSTGRES_DB:-litellm} -U ${POSTGRES_USER:-llmproxy}"]
  #     interval: 5s
  #     timeout: 5s
  #     retries: 10

  prometheus:
    image: prom/prometheus
    container_name: litellm_prometheus
    restart: always
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml
      - prometheus_data:/prometheus
    ports:
      - "9090:9090"
    command:
      - '--config.file=/etc/prometheus/prometheus.yml'
      - '--storage.tsdb.path=/prometheus'
      - '--storage.tsdb.retention.time=15d'

volumes:
  postgres_data:
    name: litellm_postgres_data
  prometheus_data:
    name: litellm_prometheus_data